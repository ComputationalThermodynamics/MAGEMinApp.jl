using ImageFiltering

model = [0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.004785775209458835 0.004785775209458835 0.006829476804010896 0.009180534752438515 0.013630509236541194 0.02133330036717881 0.02997725213723805 0.03020291230273893 0.030096685133325845 0.030096685133325845 0.030531476389539753 0.030531476389539753 0.031287486260398706 0.030590318348105636 0.02059922857461218 0.015195448366409445 0.011858373259875796 0.009580579290533103 0.007899082879663616 0.006584602368408299 0.004953676914190331 0.004953676914190331 0.003327657176530846 0.003327657176530846 0.0020199459228743746 0.0020199459228743746 0.0008740807391574768 0.0008740807391574768; 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.004785775209458835 0.004785775209458835 0.006400299070271344 0.008522664455223351 0.012355761400661955 0.01906836810403186 0.028008914886699834 0.02932141262962668 0.030096685133325845 0.030096685133325845 0.030531476389539753 0.030531476389539753 0.030419547785563716 0.030631001200179895 0.02154580496318557 0.015619464515566865 0.012035875817340648 0.009649241027740145 0.007851834475448466 0.006475942418936486 0.004953676914190331 0.004953676914190331 0.003327657176530846 0.003327657176530846 0.0020199459228743746 0.0020199459228743746 0.0008740807391574768 0.0008740807391574768; 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.0042557680858474715 0.0042557680858474715 0.006006268863141333 0.007930471743205448 0.01125653966590327 0.017088758904009675 0.025580200935201202 0.028437058972190725 0.02834192927332279 0.02834192927332279 0.028786541376265216 0.028786541376265216 0.029549501615648167 0.02976326779945039 0.02273153068423435 0.016165762870109075 0.010951782597583939 0.010951782597583939 0.00782531891318467 0.006382387483015714 0.005213262732495026 0.004229252622161357 0.0028714084033193516 0.0028714084033193516 0.001456610944771588 0.001456610944771588 0.0006801857916372903 0.00010462300891283116; 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.0030610801801591895 0.0042557680858474715 0.0042557680858474715 0.005635725763400672 0.007397591672922829 0.010298529591014382 0.015375181917668282 0.023238730660036108 0.02755791276518381 0.02834192927332279 0.02834192927332279 0.028786541376265216 0.028786541376265216 0.02867839152391685 0.028894180029852078 0.02420214765874538 0.016842609051776265 0.010951782597583939 0.010951782597583939 0.007818546357811653 0.006314784971975712 0.005081660674954902 0.004053843211559048 0.0028714084033193516 0.0028714084033193516 0.001456610944771588 0.001456610944771588 0.0003618864057535786 missing; 0.0023902347160033063 0.0023902347160033063 0.0028307940466647933 0.0028307940466647933 0.003766719285594833 0.003766719285594833 0.005290435333586255 0.006907802137803766 0.009454942391741558 0.013895698096133885 0.021042810556290554 0.026681198205825804 0.026912372203058334 0.027142186344349374 0.02704604319893015 0.02704604319893015 0.0278091971355979 0.028025796501556743 0.026041522432862813 0.017683533414529443 0.011476833130477804 0.011476833130477804 0.006992345244226822 0.006992345244226822 0.004961684595486195 0.0038879871403113097 0.0029603794242602836 0.002135914732467983 0.0013874325744768752 0.0006946165605075347 4.2396109763755646e-5 missing; 0.0023902347160033063 0.0023902347160033063 0.0028307940466647933 0.0028307940466647933 0.003766719285594833 0.003766719285594833 0.004963568302840443 0.006435780709888327 0.008708764760800155 0.01261261106637734 0.019033295036506862 0.025808922883975405 0.026042790970290174 0.026272798387304574 0.02704604319893015 0.02704604319893015 0.026942772368926327 0.02715993848811142 0.027375137130193926 0.01873040816576843 0.011476833130477804 0.011476833130477804 0.006992345244226822 0.006992345244226822 0.004853560531493849 0.0037268849529153 0.0027615584262969477 0.0019058416246384802 0.001125304989116427 0.0004038174821065075 missing missing; 0.0020880948302089346 0.0020880948302089346 0.0024773956395384208 0.0024773956395384208 0.003145125640415616 0.0037552897351157337 0.0046544422997170576 0.00597517553754436 0.009140396242896939 0.009140396242896939 0.01722149782755383 0.024466383512666515 0.025176040904929455 0.025406268612710527 0.025317327005768307 0.025317327005768307 0.026079497782731602 0.0262963510624203 0.026512741754293242 0.020041327440782474 0.012361155370346025 0.012361155370346025 0.0070915000635731655 0.0070915000635731655 0.004103177616972264 0.004103177616972264 0.002571374605636995 0.0016784922426293504 0.0008654267974209717 0.00012171400708402386 missing missing; 0.0020880948302089346 0.0020880948302089346 0.0024773956395384208 0.0024773956395384208 0.0029402292208143897 0.003515531424103892 0.004360436791664598 0.005556114458705221 0.009140396242896939 0.009140396242896939 0.015614659594419997 0.022497601823112924 0.024317335065403987 0.024548476491656472 0.025317327005768307 0.025317327005768307 0.02522024854889455 0.025438946622685196 0.025653794540318603 0.021684127492046915 0.012361155370346025 0.012361155370346025 0.0070915000635731655 0.0070915000635731655 0.004103177616972264 0.004103177616972264 0.0023966537103521863 0.0014600427790128472 0.0006136573164733769 missing missing missing; 0.0017874537180361367 0.0017874537180361367 0.00213303985086322 0.00213303985086322 0.002739264043920609 0.0032861818311888903 0.004050867474150539 0.005161919294284088 0.007757898119545761 0.007757898119545761 0.014189263060106365 0.02061099237467776 0.023465230012422837 0.023697162042798772 0.023614413111286123 0.023614413111286123 0.02405447090963062 0.02405447090963062 0.024800924085896715 0.02379893548168729 0.015891529339794257 0.011368357251578842 0.007390934990154197 0.007390934990154197 0.003974587186655333 0.003974587186655333 0.002245895369019973 0.001262654612164499 0.00037709389399771847 missing missing missing; 0.0017874537180361367 0.0017874537180361367 0.00213303985086322 0.00213303985086322 0.002544863762943393 0.003060121599123016 0.0037613403681163856 0.004792120552491337 0.007757898119545761 0.007757898119545761 0.012924189712012611 0.018859365304524794 0.022620938668680073 0.022853276222446112 0.023614413111286123 0.023614413111286123 0.02405447090963062 0.02405447090963062 0.02395432902455162 0.024166884955991595 0.01715215076302993 0.012004701416485786 0.007390934990154197 0.007390934990154197 0.003974587186655333 0.003974587186655333 0.0021117815338420934 0.0010776455127870159 0.00014806954006356152 missing missing missing; 0.0014859939004845401 0.0014859939004845401 0.0017737210483691978 0.0020109339041156347 0.0023555981490994927 0.002823069292752873 0.003765571481279814 0.003765571481279814 0.006613354112186034 0.006613354112186034 0.011800873548217839 0.01723793361945582 0.02178651550710493 0.022017483964766354 0.02194616296406262 0.02194616296406262 0.02238047235028189 0.02238047235028189 0.023115900454319334 0.023326075562421035 0.018762400163963827 0.012812049485641592 0.007979268835383729 0.007979268835383729 0.003993631770500022 0.003993631770500022 0.0020033442683026564 0.0009138825279081024 missing missing missing missing; 0.0014859939004845401 0.0014859939004845401 0.0016138209487420586 0.001840582825352907 0.0021602568477095837 0.002594320447525143 0.003765571481279814 0.003765571481279814 0.006613354112186034 0.006613354112186034 0.010798511936625241 0.01576593460926766 0.020964065379289337 0.021194216535509555 0.02194616296406262 0.02194616296406262 0.02238047235028189 0.02238047235028189 0.02228638591309039 0.02249441385234976 0.020810980158400532 0.013836831384481994 0.007979268835383729 0.007979268835383729 0.003993631770500022 0.003993631770500022 0.0019295989492672143 0.0007747962222504726 missing missing missing missing; 0.0011866110388541631 0.0011866110388541631 0.0014562649695817709 0.0016758845717730023 0.0019612100184819535 0.002370264633079817 0.0031956278127152054 0.0031956278127152054 0.005639049440643094 0.005639049440643094 0.00990193402946098 0.014426713390912355 0.020104380996902222 0.020382212477932114 0.020326355125162926 0.020326355125162926 0.020746167047245932 0.020746167047245932 0.021465647776688225 0.021672676531705265 0.021876675559238095 0.015146042777563174 0.00899437755740111 0.00899437755740111 0.004210194259296622 0.004210194259296622 0.0018874585570920453 0.0006679540563598727 missing missing missing missing; 0.0011866110388541631 0.0011866110388541631 0.0013024301639757872 0.001492078633848884 0.0017640261603226058 0.002152715346038556 0.0031956278127152054 0.0031956278127152054 0.005639049440643094 0.005639049440643094 0.00909126071278491 0.013214111857624602 0.018563876299060676 0.019582785412532354 0.020326355125162926 0.020326355125162926 0.020746167047245932 0.020746167047245932 0.020656451294381453 0.020862653657242918 0.021063408367543498 0.016823753848162416 0.00899437755740111 0.00899437755740111 0.004210194259296622 0.004210194259296622 0.0018931003597316327 0.0005946167620684209 missing missing missing missing; 0.0009320371118488206 0.001015890478505519 0.001137784044741021 0.0013121445217095782 0.0016394164657361219 0.0016394164657361219 0.0026658702700972387 0.0026658702700972387 0.004791746729385319 0.004791746729385319 0.00835661302745921 0.01211831549652377 0.01714514286033316 0.018797543171642648 0.018747392928952774 0.018747392928952774 0.01916254073402013 0.01916254073402013 0.019567523573778608 0.019567523573778608 0.020261264343260352 0.019005719267841836 0.012394340359815553 0.00838757758942924 0.004710803684295985 0.004710803684295985 0.0019461617590184376 0.0005599759878109564 missing missing missing missing; 0.000791199079704371 0.0008648687738287833 0.000968435306332295 0.0011333640611452887 0.0016394164657361219 0.0016394164657361219 0.0026658702700972387 0.0026658702700972387 0.004791746729385319 0.004791746729385319 0.007689269683521759 0.011128807243730008 0.01582449033984388 0.01802810576641155 0.018747392928952774 0.018747392928952774 0.01916254073402013 0.01916254073402013 0.019567523573778608 0.019567523573778608 0.0194740429119493 0.019667453845289385 0.013842327652118737 0.009186144248066774 0.004710803684295985 0.004710803684295985 0.002057685669857471 0.0005713903320810642 missing missing missing missing; 0.0006414333070017171 0.0007017734909504147 0.0007994354201101657 0.0009559924239247971 0.0012428896901204053 0.0012428896901204053 0.0021716226010855518 0.0021716226010855518 0.004042296414953692 0.004042296414953692 0.0081536454989751 0.0081536454989751 0.01460437173381454 0.01727586985328228 0.01749394803512103 0.017727797792117892 0.017647762500198547 0.017647762500198547 0.018029997743039462 0.018029997743039462 0.018698289273156782 0.01888947173968463 0.01572465459165175 0.010213502335923571 0.005624808440995803 0.005624808440995803 0.002239930455769562 0.0006405945396295517 missing missing missing missing; 0.00046576315140487974 0.0005188195129417136 0.0006307921911845089 0.0007797273719499396 0.0012428896901204053 0.0012428896901204053 0.0021716226010855518 0.0021716226010855518 0.004042296414953692 0.004042296414953692 0.0081536454989751 0.0081536454989751 0.01348067044344705 0.01653984634762835 0.016756709101345985 0.016981941234898813 0.017647762500198547 0.017647762500198547 0.018029997743039462 0.018029997743039462 0.017941861481491173 0.018128928750174293 0.01817289888259292 0.011534062962545576 0.005624808440995803 0.005624808440995803 0.002503853221836741 0.0007717268194845454 missing missing missing missing; 0.00030857678846810604 0.00030857678846810604 0.00042236556184270865 0.0005984292059131226 0.0008224819757836586 0.001120143287394976 0.0015500355569647605 0.002143587076381578 0.0029850084191164563 0.004202567108295183 0.005998371498214929 0.008673146504186434 0.012452835048008334 0.015829188736217005 0.016039321854837967 0.016267958128768256 0.016192618899480628 0.016192618899480628 0.01656386471238927 0.01656386471238927 0.01692976977524122 0.01692976977524122 0.01756443152426255 0.013246674542332632 0.008444593841834205 0.005236953113687427 0.002867425635102276 0.0009787454581387284 missing missing missing missing; 0.00030857678846810604 0.00030857678846810604 0.00021627360288802098 0.00035451792352247604 0.0005930714612126811 0.0009214015451761209 0.001333197595116082 0.0019033523500140766 0.002701475955599766 0.0038457207603471047 0.005520980311045785 0.007999495121728371 0.011517234440595608 0.015140782806335193 0.015344834558678858 0.015566180139045803 0.016192618899480628 0.016192618899480628 0.01656386471238927 0.01656386471238927 0.01692976977524122 0.01692976977524122 0.016835696876993135 0.015501489005647975 0.009712685430749561 0.006006027109188961 0.0033500988688974533 0.0012770953957401989 missing missing missing missing; 0.0020913322277544503 0.0006422001009669076 0.0001861092607285883 0.0001467445800324189 0.0003213793646626839 0.0006333476188398439 0.0010634628068359499 0.0016397087925889562 0.002422289808553294 0.0035106055883995066 0.005080111483884362 0.007382694545999728 0.010660770397773653 0.01439981057186148 0.014676134180886296 0.014889327652886909 0.014829846475535537 0.014829846475535537 0.015191927303201052 0.015191927303201052 0.015541219772871425 0.015541219772871425 0.016127020874317416 0.016294533380831523 0.011354087061476104 0.006998528173445109 0.0039812641434094674 0.0016833759742013545 missing missing missing missing; 0.005122772094874048 0.002572807565896998 0.0008341298104070911 0.00024025981786729238 0.00015798812343410868 0.00035336227367361076 0.000743215626509286 0.0013098626378668288 0.0020851632650171112 0.003158821525239402 0.004698466834120588 0.006980020586483879 0.010452753325953279 0.012799366364625486 0.013942422447494258 0.01423181703407489 0.014829846475535537 0.014829846475535537 0.015191927303201052 0.015191927303201052 0.015541219772871425 0.015541219772871425 0.015448720432311689 0.015607036576945434 0.013519532978980975 0.008280566221976203 0.004795682111376419 0.0022198161648537412 0.00016165421572797992 missing missing missing; 0.005521088667639567 0.004248643690640624 0.0026923082376424288 0.0013987163660302711 0.0005170338294948504 0.00034088194747543537 0.0005525355518288528 0.001048174096903652 0.0018252203895015196 0.002965969539317604 0.004677354953951438 0.0074461861116959325 0.009502055065879197 0.010912494966468043 0.012279251165453886 0.013463626832865989 0.013792534740383564 0.013970552707568622 0.013923159930730431 0.013923159930730431 0.014247767702449711 0.014247767702449711 0.01480348291223263 0.014959070784378865 0.015103185534569817 0.009939370504342876 0.005842711199351586 0.002918905887765087 0.0006360143371858597 missing missing missing; 0.005299988111265744 0.005229730494472587 0.0035789724061177208 0.0022464481152076683 0.001178561419277381 0.0006529615390052882 0.0006993676523031663 0.0011305931048202727 0.001881151089422077 0.0031867799680338343 0.00453134110717162 0.005953162080891438 0.0073923880095585265 0.008840022888931431 0.01029615390342044 0.011710174170613685 0.012950406363974263 0.013374349595790539 0.013923159930730431 0.013923159930730431 0.014247767702449711 0.014247767702449711 0.014176307331343717 0.014326843463963386 0.014479024332562283 0.012125032425626986 0.007197486617637075 0.0038195082697933987 0.0012591616952454478 missing missing missing; 0.005071805960991914 0.005185490327023631 0.004488539031768806 0.0030655583119667037 0.0019102670632183342 0.0009764651890574716 0.00028476147237727474 0.00028510342878855407 0.0006664184988599786 0.0014095898653768645 0.0024699487708248935 0.0037565769708863763 0.004746406466354216 0.004746406466354216 0.007713617272402002 0.007713617272402002 0.01108541496872789 0.012406154275633808 0.012982050128928384 0.013138999198766984 0.013092578913438027 0.013092578913438027 0.013380519254904865 0.013380519254904865 0.013873889404027425 0.014013921957679538 0.008958199576738712 0.004978638746626036 0.0020641110791318447 missing missing missing; 0.004836893393410121 0.004950383731240023 0.005063871881102841 0.003913713881075161 0.0026728128031501455 0.0016592623600128918 0.0008333073725449986 0.00016868834883048526 missing 0.00018458689181355265 0.0008048377426501529 0.0017417238993500598 0.004746406466354216 0.004746406466354216 0.007713617272402002 0.007713617272402002 0.008839430878616059 0.010386911635809574 0.011811918120782784 0.012611116506027626 0.013092578913438027 0.013092578913438027 0.013380519254904865 0.013380519254904865 0.013311280203647392 0.013444784505813273 0.011281208847321674 0.006487531295393487 0.0030995368757690024 0.0004915358510982276 missing missing; 0.004529786697018907 0.004529786697018907 0.004822465254250879 0.0048037858680455405 0.0034690944053512368 0.002374635660790658 0.0014039019733935855 0.0014039019733935855 0.00013720613237180147 missing missing 0.00022768358421208285 0.001026342777353715 0.002102197927131869 0.0033995506422450023 0.004844966048100411 0.005879441564403086 0.005879441564403086 0.00959276956170865 0.011136756104684425 0.012271030270665367 0.01240598203054818 0.01254142578723196 0.01266599591703027 0.012796616275452533 0.012919823610308502 0.013040155696075632 0.008423620316891967 0.0044418257945404984 0.0014492369261104813 missing missing; 0.004529786697018907 0.004529786697018907 0.004575423675935609 0.00468849789528064 0.004311197868132293 0.0031279037700004094 0.0014039019733935855 0.0014039019733935855 0.0006784164991159433 0.00013232498008315858 missing missing missing 0.0003403137214492254 0.0012659107647395233 0.002448124137436322 0.005879441564403086 0.005879441564403086 0.006981265635543961 0.008676031463076371 0.010349342554656712 0.01177520837247254 0.012072318656713285 0.012199113994326514 0.012319439983196697 0.012437732937786985 0.012552872273828819 0.010985251907927861 0.0061426096527505605 0.0026779676950329134 missing missing; 0.0040214035768531805 0.0040214035768531805 0.004250505578044169 0.004250505578044169 0.0045486461489124864 0.003930481636167543 0.0028698167253297254 0.001990015747416907 0.00122943219571722 0.00122943219571722 0.00014944546101237997 missing missing missing missing 0.0004633619073660322 0.0014921131436478894 0.002762496451776481 0.004235276985891129 0.0058625326342114535 0.00760860652613142 0.009402046940462974 0.011037941536559858 0.011779205180330442 0.011894159444246188 0.012000625271661354 0.012109377027960609 0.012213655269873523 0.008358049309154491 0.004235699580619698 0.0011160429026171009 missing; 0.0040214035768531805 0.0040214035768531805 0.004250505578044169 0.004250505578044169 0.004290453733743533 0.004403310800244489 0.0036416336040097207 0.002680484873333162 0.00122943219571722 0.00122943219571722 0.0006497206676225756 0.00018491709594190423 missing missing missing missing missing 0.0005749237386787328 0.0016834004335273785 0.0030393296441362915 0.004614940057576432 0.006371616325553022 0.008254033996040017 0.010097385427999223 0.011502373835029965 0.011609994826377057 0.011712416541927218 0.011809388505676952 0.011283518020909662 0.0062310774835544975 0.002577642462944148 missing; 0.003482130832721431 0.003482130832721431 0.003718227890600711 0.003718227890600711 0.003948425549555326 0.003948425549555326 0.004252654797463206 0.0034283122700943676 0.0025485434342465575 0.0018105466092201814 0.0011924422450108046 0.0011924422450108046 0.00023662199293597884 missing missing missing missing missing missing 0.0006458920084048966 0.0018239986476617017 0.003271557382426065 0.004217709998172567 0.004217709998172567 0.008884903502136554 0.010683180223401012 0.011345692810518566 0.011443435025700227 0.011532944431599504 0.008810887732823207 0.004424312919146302 0.0010829302679832332; 0.003482130832721431 0.003482130832721431 0.003718227890600711 0.003718227890600711 0.003948425549555326 0.003948425549555326 0.003983267470707056 0.004096403025468565 0.0032802995764371953 0.002465714629359255 0.0011924422450108046 0.0011924422450108046 0.0007125475472294719 0.00030261734128266183 missing missing missing missing missing missing missing 0.0006628328362123509 0.004217709998172567 0.004217709998172567 0.00528665181588534 0.007353799129418636 0.009436789793696764 0.011113889728044557 0.011192893923041281 0.011273923515051666 0.006775602521797763 0.0028296687316882218]

in =  Matrix{Union{Float64,Missing}}(undef,size(model))
in .= model
in[ismissing.(model)] .= -0.001;


kx = Kernel.gaussian((1,), (9,))
ky = Kernel.gaussian((1,), (9,))
blurxy = imfilter(in, (kx', ky))

out =  Matrix{Union{Float64,Missing}}(undef,size(in))
out .= blurxy
out[isless.(blurxy, 1e-8)] .= missing 

model

out
